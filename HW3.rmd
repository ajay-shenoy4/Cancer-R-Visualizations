---
title: "HW3"
author: "Ajay Shenoy"
date: "2025-11-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(leaflet)
library(tidytuesdayR)
library(ggmap)

# Using R
# Option 1: tidytuesdayR R package 
## install.packages("tidytuesdayR")

tuesdata <- tidytuesdayR::tt_load('2025-10-07')
## OR
tuesdata <- tidytuesdayR::tt_load(2025, week = 40)

euroleague_basketball <- tuesdata$euroleague_basketball
```

a) 
I have chosen the TidyTuesday data from October 7, 2025. This dataset is about European basketball, the Euroleague. This data has each team, their home city, arena, capacity, standing last season, country, final four appearances all time, titles won all time, years of final four appearances, and years of titles won. This data does not go much into depth but it could be useful to see some surface level information about Euroleague. We can see what all the teams are in the competition, their location across the continent, and their relative success. One immediate visualization I could think of would be to graph these teams on a sort of worldmap based on their home city. I would use color of dots to coordinate team names, and I could use size of the dots to resemble success in winning, with the larger their dot, the more success that team has had. I could also see if stadium capacity has any influence on team success. Overall there is not much to display from the data but there are some interesting ideas. 

b) 

I have found one posting for this tidytuesday. This one is a graph of the home arena capacities for each team. It has the teams on the y axis and the x axis is the capacity. It is a visual that is very easy to understand and tells us stadium capapcity very well, however it does not tell us much other information from the data. I have also found another posting for this tidytuesday. This one is showing the teams' final four and title appearances. This one also has the teams on the y axis and the x axis is the year. Here we have circles plotted to represent final four appearances and championship wins. It is good to see the success of all the teams currently in Euroleague as time progresses. Overall the graphs are similar, but plot very different things. I would have used dynamic graphing queries to graph all of that information. 

c)
```{r}
library(tidyverse)
library(leaflet)
library(tidytuesdayR)
library(tidygeocoder)
library(shiny)
library(scales)  # for rescaling numeric values

# Load data
tuesdata <- tidytuesdayR::tt_load('2025-10-07')
euroleague_basketball <- tuesdata$euroleague_basketball %>%
  mutate(
    Capacity = as.numeric(gsub(",", "", Capacity)),
    Titles_Won = as.numeric(Titles_Won),
    FinalFour_Appearances = as.numeric(FinalFour_Appearances)
  )

# Geocode home cities
coords <- euroleague_basketball %>%
  distinct(`Home city`, Country) %>%
  mutate(location = paste(`Home city`, Country, sep = ", ")) %>%
  geocode(location, method = "osm", lat = lat, long = lon)

# Join coordinates
euroleague_basketball <- euroleague_basketball %>%
  left_join(coords, by = c("Home city", "Country"))

# Shiny UI + server
size_choices <- c(
  "Titles Won" = "Titles_Won",
  "Capacity" = "Capacity",
  "Final Four Appearances" = "FinalFour_Appearances"
)

ui <- fluidPage(
  titlePanel("Euroleague Teams Map"),
  sidebarLayout(
    sidebarPanel(
      selectInput("size_var", "Choose circle size variable:", 
                  choices = size_choices, selected = "Titles_Won")
    ),
    mainPanel(
      leafletOutput("map", height = 600)
    )
  )
)

server <- function(input, output, session) {
  
  # Make a color palette where each team is a distinct color
  pal <- colorFactor(topo.colors(nrow(euroleague_basketball)), euroleague_basketball$Team)
  
  output$map <- renderLeaflet({
    
    size_var <- input$size_var
    values <- euroleague_basketball[[size_var]]
    
    # Rescale selected variable for circle radius
    radius_vals <- rescale(values, to = c(5, 25))
    
    # Create bottom-left size legend HTML
    size_legend <- paste0(
      "<b>Circle size = ", input$size_var, "</b><br>",
      "Min: ", min(values, na.rm = TRUE), "<br>",
      "Max: ", max(values, na.rm = TRUE)
    )
    
    leaflet(euroleague_basketball) %>%
      addProviderTiles(providers$CartoDB.Positron) %>%
      fitBounds(lng1 = -10, lat1 = 30, lng2 = 60, lat2 = 55) %>%
      setMaxBounds(lng1 = -25, lat1 = 20, lng2 = 80, lat2 = 70) %>%
      addCircleMarkers(
        lng = ~lon, lat = ~lat,
        radius = radius_vals,
        color = ~pal(Team),
        fillOpacity = 0.8,
        popup = ~paste0("<b>", Team, "</b><br>",
                        "City: ", `Home city`, "<br>",
                        "Arena: ", Arena, "<br>",
                        "Capacity: ", Capacity, "<br>",
                        "Titles: ", Titles_Won,
                        "<br>Final Four Appearances: ", FinalFour_Appearances)
      ) %>%
      addLegend("topright", pal = pal, values = ~Team, title = "Team") %>%
      addControl(html = size_legend, position = "bottomleft")
  })
}

# Launch the app
shinyApp(ui = ui, server = server)
```
